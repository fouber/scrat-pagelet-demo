!function(e){function t(){}function r(e,r,n){var o,a="js"===r,i="css"===r,c=document.createElement(a?"script":"link"),l="onload"in c,s=setTimeout(function(){clearTimeout(s),clearInterval(o),n("timeout")},v);a?(c.type="text/javascript",c.src=e):(i&&(c.type="text/css",c.rel="stylesheet"),c.href=e),c.onload=c.onreadystatechange=function(){!c||c.readyState&&!/loaded|complete/.test(c.readyState)||(clearTimeout(s),c.onload=c.onreadystatechange=t,a&&T&&c.parentNode&&T.removeChild(c),n(),c=null)},c.onerror=function(t){clearTimeout(s),clearInterval(o),t=(t||{}).error||new Error("load resource timeout"),t.message="Error loading ["+e+"]: "+t.message,n(t)},T.appendChild(c),i&&(g||!l)&&(o=setInterval(function(){c.sheet&&(clearTimeout(id),clearInterval(o),n())},20))}function n(e,t){return Object.prototype.toString.call(e)==="[Object "+t+"]"}function o(e,t,r){if(t&&t.length&&(t=t.filter(function(e){var t=m[e]===!0;return m[e]=!0,!t}),t.length))if(R){var n=t.join(",");e.push({uri:y.replace("%s",n),type:r})}else t.forEach(function(t){e.push({uri:t,type:r})})}function a(e){var t=document.createElement("script");t.appendChild(document.createTextNode(e)),T.appendChild(t)}function i(e){return!!e}function c(e){e&&e.readyState<4&&(e.onreadystatechange=t,e.abort())}function l(e){if("object"==typeof e){var t;if(e instanceof Array)t=[],e.forEach(function(e,r){t[r]=l(e)});else{t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=l(e[r]))}return t}return e}function s(e,t,r){var n=[],o=E("/").replace(/\/$/,"");0===t.indexOf(o)&&(t=t.substring(o.length)),"string"==typeof e&&(e=e.replace(/:(\w+)|[\.\\\+\*\?\[\^\]\$\(\){}=!<>\|:\/]/g,function(e,t){return t?(n.push(t),"([\\w.\\-\\s]+)"):"*"===e?".*?":"\\"+e})||"",e=new RegExp("^"+e+"$"));var a=t.match(e);return a?(r=r||{},a.forEach(function(e,t){r[n[t-1]||t]=e}),!0):!1}function u(e,t){for(var r=!0,n=function(){r=!0},o={},a=0,i=L.length;i>a&&r;a++){var c=L[a];s(c.reg,e.url,o)&&(r=!1,c.callback(o,e,t,n))}return!r}function E(e){return C.href=e,C.href}function f(e,t){return e=E(e),t=E(t),V[e+A+t]||V[t+A+e]}function p(e,t,r){e=E(e),t=E(t),V[e+A+t]=r,V[t+A+e]=r}var d,_,h=e.pagelet={},m={},g=+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,T=document.head||document.getElementsByTagName("head")[0],v=6e4,R=!1,O="/co??%s",y=O,N=e.history&&e.history.pushState&&e.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),S={},L=[],V={},A="<->",C=document.createElement("a");h.EVENT_BEFORE_LOAD="before_load",h.EVENT_LOAD_ERROR="load_error",h.EVENT_LOAD_COMPLETED="load_completed",h.EVENT_GO_ERROR="load_error",h.EVENT_BACK_ERROR="back_error",h.EVENT_GO_LOADED="go_loaded",h.EVENT_LOAD_PROGRESS="load_progress",h.EVENT_BEFORE_EXEC_SCRIPTS="before_exec_scripts",h.EVENT_AFTER_EXEC_SCRIPTS="after_exec_scripts",h.EVENT_BEFORE_INSERT_HTML="before_insert_html",h.EVENT_AFTER_INSERT_HTML="after_insert_html",h.EVENT_BEFORE_GO="before_go",h.EVENT_AFTER_GO="after_go",h.EVENT_GO_COMPLETED="go_completed",h.on=function(e,t){var r=S[e]||[];r.push(t),S[e]=r},h.off=function(e,t){var r=S[e];r&&(S[e]=r.filter(function(e){return e!==t}))},h.emit=function(e,t){var r=S[e];r&&r.length&&r.forEach(function(e){e(t)})},h.init=function(e,t,r){R=!!e,y=t||O,r&&r.length&&r.forEach(function(e){m[e]=!0})},h.load=function(i){var l=i.url,s=i.pagelets,u=i.complete||t,E=i.success||t,f=i.error||t,p=i.progress||t;if(s&&s.length){h.emit(h.EVENT_BEFORE_LOAD,{options:i});var _=function(e,r,n){_=t,e?(h.emit(h.EVENT_LOAD_ERROR,{options:i,error:e}),f(e)):(h.emit(h.EVENT_BEFORE_INSERT_HTML,{options:i,data:r}),E(r,n)!==!1&&n(),h.emit(h.EVENT_AFTER_INSERT_HTML,{options:i,data:r})),h.emit(h.EVENT_LOAD_COMPLETED,{options:i,error:e,data:r}),u(e,r,n)};n(s,"String")&&(s=s.split(/\s*,\s*/)),c(d),d=new e.XMLHttpRequest,d.onprogress=function(e){var t={options:i,event:e};h.emit(h.EVENT_LOAD_PROGRESS,t),p(t)},d.onreadystatechange=function(){if(4==d.readyState){d.onreadystatechange=t;var e,n=null;if(d.status>=200&&d.status<300||304==d.status){e=d.responseText;try{e=JSON.parse(e)}catch(i){n=i}if(n)_(n);else{var c=[];o(c,e.js,"js"),o(c,e.css,"css");var l=function(){if(h.emit(h.EVENT_BEFORE_EXEC_SCRIPTS,e.script),e.script&&e.script.length){var r="!function(){",n="}();\n",o=r+e.script.join(n+r)+n;a(o)}l=t,h.emit(h.EVENT_AFTER_EXEC_SCRIPTS,e.script)},s=function(){l()};if(c&&c.length){var u=c.length;c.forEach(function(t){r(t.uri,t.type,function(t){u--,0===u&&_(n,e,s),n=t})})}else _(n,e,s)}}else n=d.statusText||(d.status?"error":"abort"),_(n)}},l+=-1===l.indexOf("?")?"?":"&",l+="_pagelets="+s.join(","),d.open("GET",l,!0),d.setRequestHeader("Accept","application/json"),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("X-Pagelets",s.join(",")),d.send()}else location.href=l},h.pushState=function(t){_||(_={url:e.location.href,title:document.title},e.history.replaceState(_)),p(_.url,t.url,t.pagelets);var r=t.replace?"replaceState":"pushState";return e.history[r](null,"",t.url),function(r){_={url:t.url,title:r},e.history.replaceState(_,r,t.url);try{document.activeElement.blur()}catch(n){}}},h.go=function(r){var n=r.pagelets;if(N&&n){h.emit(h.EVENT_BEFORE_GO,r);var o=l(r);o.error=function(e){h.emit(h.EVENT_GO_ERROR,{options:r,error:e}),"function"==typeof r.error&&r.error(e)},o.success=function(e,t){if(h.emit(h.EVENT_GO_LOADED,{options:r,data:e}),e.title?document.title=e.title:e.title=document.title,a(e.title),"function"==typeof r.success){var n=r.success(e,t);return h.emit(h.EVENT_AFTER_GO,{options:r,data:e}),n}},o.complete=function(e,t,n){h.emit(h.EVENT_GO_COMPLETED,r),"function"==typeof r.complete&&r.complete(e,t,n)},_||(_={url:e.location.href,title:document.title},e.history.replaceState(_)),h.load(o);var a=d.readyState>0?h.pushState(r):t}else location.href=url},h.router=function(e,t){L.push({reg:e,callback:t})},h.autoload=function(t,r){N&&("string"==typeof t&&(t=[t]),r=r||"click",e.addEventListener("popstate",function(e){if(e.state){var r=t;if(_){var n=f(_.url,e.state.url);n?r=n:p(_.url,e.state.url,r)}if(_=e.state,r){var o={};o.url=_.url,o.pagelets=r,o.isBack=!0,o.error=function(e){h.emit(h.EVENT_BACK_ERROR,{options:o,error:e}),location.replace(o.url)},u(o,e)||(o.success=function(e){e.title&&(document.title=e.title);var t=e.html;for(var r in t)if(t.hasOwnProperty(r)){var n=document.querySelector('[data-pagelet="'+r+'"]');if(!n)throw new Error("undefined parent dom ["+r+"]");n.innerHTML=t[r],n=null}},h.load(o))}else location.replace(_.url)}},!1),document.documentElement.addEventListener(r,function(e){for(var t=e.target;t&&t.tagName&&"a"!==t.tagName.toLowerCase();)t=t.parentNode;if(t){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return;if(location.protocol!==t.protocol||location.hostname!==t.hostname)return;var r=t.getAttribute("data-pagelets"),n=(t.getAttribute("data-insert-type")||"replace").toLocaleLowerCase(),o=t.getAttribute("href");if(r=(r||"").split(/\s*,\s*/).filter(i),o&&r.length>0){e.preventDefault(),e.stopPropagation();var a={};a.url=o,a.pagelets=r,a.replace="prepend"===n||"append"===n,a.error=function(){location.replace(o)},u(a,e)||(a.success=function(e){var t=e.html;for(var r in t)if(t.hasOwnProperty(r)){var o=document.querySelector('[data-pagelet="'+r+'"]');if(!o)throw new Error("undefined parent dom ["+r+"]");if("prepend"===n||"append"===n){var a=document.createElement("div");a.innerHTML=t[r];for(var i=document.createDocumentFragment(),c=a.childNodes;c.length;)i.appendChild(c[0]);"append"===n||0===o.childNodes.length?o.appendChild(i):o.insertBefore(i,o.childNodes[0])}else o.innerHTML=t[r];o=null}},h.go(a))}}},!1))}}(window);